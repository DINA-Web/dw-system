fs_db.nf:
  image: tianon/true
  volumes:
    - ./mysql_nf-datadir:/var/lib/mysql:z
    - ./mysql_nf-shr:/shr:z
    - ./mysql_nf-autoload:/docker-entrypoint-initdb.d:ro
    - ./mysql_nf-conf.d:/etc/mysql/conf.d:z

fs_db.media:
  image: tianon/true
  volumes:
    - ./mysql_media-datadir:/var/lib/mysql:z
    - ./mysql_media-shr:/shr:z
    - ./mysql_media-autoload:/docker-entrypoint-initdb.d:ro
    - ./mysql_media-conf.d:/etc/mysql/conf.d:z

fs_ws:
  image: tianon/true
  volumes:
    - ./nginx-html:/usr/share/nginx/html:z
    - ./nginx-conf:/etc/nginx/conf.d:z
    - ./nginx-certs:/etc/nginx/ssl:z
    - ./nginx-logs:/etc/nginx/logs:z

db.nf:
  image: mysql:5.5
  environment:
    - TZ=Europe/Stockholm
    - MYSQL_ROOT_PASSWORD=supersecret
    - MYSQL_DATABASE=taxonpages_v2
    - MYSQL_USER=naturalist
    - MYSQL_PASSWORD=passw0rd12
  ports:
    - "13306:3306"
  volumes_from:
    - fs_db.nf

db.media:
  image: mysql:5.5
  environment:
    - TZ=Europe/Stockholm
    - MYSQL_ROOT_PASSWORD=supersecret
    - MYSQL_DATABASE=nf_media
    - MYSQL_USER=mediaserver
    - MYSQL_PASSWORD=mediaserver
  ports:
    - "23306:3306"
  volumes_from:
    - fs_db.media

fs_naturalist:
  image: tianon/true
  volumes:
    - ./srv/data:/opt/data
    - ./srv/deployments:/opt/jboss/wildfly/standalone/deployments:z

as:
  build: ./wildfly-custom
  ports:
    - "8080"
    - "9990"
  volumes_from:
    - fs_naturalist
  links:
    - db.nf:dbnf
    - db.media:dbmedia

ws:
  image: nginx
  ports:
    - "80:80"
    - "443:443"
  volumes_from:
    - fs_ws
  links:
    - as
